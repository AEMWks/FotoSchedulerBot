# web/.htaccess
RewriteEngine On

# Headers CORS
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type"

# API Routes - Rutas amigables para las APIs

# API de fotos por fecha específica
RewriteRule ^api/photos/([0-9]{4})/([0-9]{2})/([0-9]{2})/?$ /api/photos.php?year=$1&month=$2&day=$3 [L,QSA]

# API de búsqueda y filtrado
RewriteRule ^api/search/?$ /api/search.php [L,QSA]

# API de estadísticas
RewriteRule ^api/stats/?$ /api/stats.php [L,QSA]

# API de fechas disponibles
RewriteRule ^api/dates/?$ /api/dates.php [L,QSA]

# API de exportación
RewriteRule ^api/export/?$ /api/export.php [L,QSA]

# API de contenido aleatorio
RewriteRule ^api/random/?$ /api/random.php [L,QSA]

# API de calendario
RewriteRule ^api/calendar/?$ /api/calendar.php [L,QSA]
RewriteRule ^api/calendar/([0-9]{4})/([0-9]{1,2})/?$ /api/calendar.php?year=$1&month=$2 [L,QSA]

# API de feed principal
RewriteRule ^api/feed/?$ /api/feed.php [L,QSA]

# Rutas adicionales para funcionalidades específicas

# Exportar por tipo y fecha
RewriteRule ^api/export/day/([0-9]{4}-[0-9]{2}-[0-9]{2})/?$ /api/export.php?type=day&date=$1 [L,QSA]
RewriteRule ^api/export/week/([0-9]{4}-[0-9]{2}-[0-9]{2})/?$ /api/export.php?type=week&date=$1 [L,QSA]
RewriteRule ^api/export/month/([0-9]{4}-[0-9]{2})/?$ /api/export.php?type=month&month=$1 [L,QSA]

# Estadísticas por período
RewriteRule ^api/stats/([0-9]{4})/([0-9]{2})/?$ /api/stats.php?start_date=$1-$2-01&end_date=$1-$2-31 [L,QSA]
RewriteRule ^api/stats/([0-9]{4})/?$ /api/stats.php?start_date=$1-01-01&end_date=$1-12-31 [L,QSA]

# Búsqueda por año/mes/día
RewriteRule ^api/search/([0-9]{4})/?$ /api/search.php?year=$1 [L,QSA]
RewriteRule ^api/search/([0-9]{4})/([0-9]{2})/?$ /api/search.php?year=$1&month=$2 [L,QSA]
RewriteRule ^api/search/([0-9]{4})/([0-9]{2})/([0-9]{2})/?$ /api/search.php?year=$1&month=$2&day=$3 [L,QSA]

# Random por tipo
RewriteRule ^api/random/photos/?$ /api/random.php?type=photo [L,QSA]
RewriteRule ^api/random/videos/?$ /api/random.php?type=video [L,QSA]

# Headers de cache para archivos estáticos
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
    Header set Cache-Control "max-age=31536000, public"
</FilesMatch>

# Headers de cache para APIs (no cache)
<FilesMatch "\.php$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Seguridad - Evitar acceso directo a archivos sensibles
<Files "*.json">
    Order allow,deny
    Deny from all
</Files>

<Files "*.log">
    Order allow,deny
    Deny from all
</Files>

# Página de error personalizada para APIs
ErrorDocument 404 /api/error.php
